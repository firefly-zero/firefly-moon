# SPDX-FileCopyrightText: 2025 Kalle Fagerberg
#
# SPDX-License-Identifier: CC0-1.0

version: 3

vars:
  MOON_MODULES:
    sh: echo ./src && find ./example -maxdepth 1 -mindepth 1 -type d
  EXAMPLES:
    sh: find ./example -maxdepth 1 -mindepth 1 -type d

tasks:
  format:
    cmds:
      - for: { var: MOON_MODULES }
        cmd: moon fmt -C {{.ITEM}}

  lint:
    cmds:
      - for: { var: MOON_MODULES }
        cmd: moon check -C {{.ITEM}}
      - for: { var: MOON_MODULES }
        cmd: moon fmt -C {{.ITEM}} --check

  test:
    cmds:
      - for: { var: MOON_MODULES }
        cmd: moon test -C {{.ITEM}}
      - for: { var: EXAMPLES }
        cmd: firefly_cli build {{.ITEM}}

  all:
    cmds:
      - task: format
      - task: lint
      - task: test
